### This Step is no longer needed since we have already renamed dpp covariates to go with Tibor's naming convention (GC 10/22/2018)

###LOAD LIBRARIES
library(dplyr)

#load DPP dataset
library(RODBC)
library(tidyverse)

myconn <-odbcConnect("DPP Share",believeNRows = FALSE)
LTF225 <- sqlQuery(myconn, "select * from O141PUBS.LTF225", as.is=TRUE)
odbcCloseAll()

df <- LTF225


#rename DPP variables to variables that are used in all subsequent scripts
#variable names follow a convention where:
#0 ending denotes a baseline (0 yr) variable
#1 ending denotes a follow-up (1 yr) variable
#t2d_short are T2D at 3.2yr and t2d_long are T2D at 15yr

#please write the original DPP variable name (twice!) as demonstrated in the first row
#this will rename the DPP variable to my naming convention
#and delete the column with the original name
df_renamed <- df %>%
  rename(tg0 = standNTG, #triglycerides baseline
         tc0 = standNTC, #total cholesterol baseline
         ldl0 = standLDL, #LDL cholesterol baseline
         hdl0 = standHDL, #HDL cholesterol baseline
         apob0 = NMR_ApoB, #ApoB baseline
         apoa10 = ApoA1, #ApoA1 baseline
         hdl_l0 = L_cHDLP, #HDL large baseline
         hdl_m0 = M_cHDLP, #HDL medium baseline
         hdl_s0 = S_cHDLP, #HDL small baseline
         hdltotal0 = cHDLP, #HDL total baseline
         H7P0 = H7P, #H7P baseline
         H6P0 = H6P, #H6P baseline
         H5P0 = H5P, #H5P baseline
         H4P0 = H4P, #H4P baseline
         H3P0 = H3P, #H3P baseline
         H2P0 = H2P, #H2P baseline
         H1P0 = H1P, #H1P baseline
         ldl_l0 = L_LDLP, #LDL large baseline
         ldl_m0 = M_LDLP, #LDL medium baseline
         ldl_s0 = S_LDLP, #LDL small baseline
         ldltotal0 = LDLP, #LDL total baseline
         trl_vl0 = VL_TRLP, #TRL very large baseline
         trl_l0 = L_TRLP, #TRL large baseline
         trl_m0 = M_TRLP, #TRL medium baseline
         trl_s0 = S_TRLP, #TRL small baseline
         trl_vs0 = VS_TRLP, #TRL very small baseline
         trltotal0 = TRLP, #TRL total baseline
         hdlsize0 = HDLZ, #HDL size baseline
         ldlsize0 = LDLZ, #LDL size baseline
         trlsize0 = TRLZ, #TRL size baseline
         trl_tg0 = NTG, #TRL carried TG baseline           #not sure (GC)
         trl_c0 = NTC, #TRL carried cholesterol baseline   #not sure (GC)
         ppd0 = LDLsize, #LDL PPD baseline
         tg1 = standNTG_1, #triglycerides follow-up
         tc1 = standNTC_1, #total cholesterol follow-up
         ldl1 = standLDL_1, #LDL cholesterol follow-up
         hdl1 = standHDL_1, #HDL cholesterol follow-up
         apob1 = NMR_ApoB_1, #ApoB follow-up
         apoa11 = ApoA1_1, #ApoA1 follow-up
         hdl_l1 = L_cHDLP_1, #HDL large follow-up
         hdl_m1 = M_cHDLP_1, #HDL medium follow-up
         hdl_s1 = S_cHDLP_1, #HDL small follow-up
         hdltotal1 = cHDLP_1, #HDL total follow-up
         H7P1 = H7P_1, #H7P follow-up
         H6P1 = H6P_1, #H6P follow-up
         H5P1 = H5P_1, #H5P follow-up
         H4P1 = H4P_1, #H4P follow-up
         H3P1 = H3P_1, #H3P follow-up
         H2P1 = H2P_1, #H2P follow-up
         H1P1 = H1P_1, #H1P follow-up
         ldl_l1 = L_LDLP_1, #LDL large follow-up
         ldl_m1 = M_LDLP_1, #LDL medium follow-up
         ldl_s1 = S_LDLP_1, #LDL small follow-up
         ldltotal1 = LDLP_1, #LDL total follow-up
         trl_vl1 = VL_TRLP_1, #TRL very large follow-up
         trl_l1 = L_TRLP_1, #TRL large follow-up
         trl_m1 = M_TRLP_1, #TRL medium follow-up
         trl_s1 = S_TRLP_1, #TRL small follow-up
         trl_vs1 = VS_TRLP_1, #TRL very small follow-up
         trltotal1 = TRLP_1, #TRL total follow-up
         hdlsize1 = HDLZ_1, #HDL size follow-up
         ldlsize1 = LDLZ_1, #LDL size follow-up
         trlsize1 = TRLZ_1, #TRL size follow-up
         trl_tg1 = NTG_1, #TRL carried TG follow-up           #not sure (GC)
         trl_c1 = NTC_1, #TRL carried cholesterol follow-up   #not sure (GC)
         ppd1 = LDLsize_1, #LDL PPD follow-up
         age = age, #age
         ethnicity = race6, #self reported ethnicity
         female = sex, #sex
         treatment_arm = ASSIGN, #treatment arm
         bmi = bmi, #BMI
         waist = waist, #waist circumference
         fasting_glu = G000, #fasting glucose
         ogtt_glu = G120, #2 hour glucose
         hba1c = HBA1, #HbA1c
         syst_bp = sbp, #systolic blood pressure
         t2d_hist = famhxdb, #family history of T2D
         gdm_hist = gdm, #history of GDM (gestational diabetes)
         bp_med = rx_highbp, #blood pressure medication
         lipid_med = rx_highldl, #any lipid lowering medication
         statin_med = rx_statin, #statins
         diab_med = rx_highgluc, #antidiabetic medication
         IG_RAT = igrat, #insulin - glucose ratio (measure of insulin secretion)
         t2d_short = diabfdpp, #T2D at 3.2 years
         t2d_long = diabfos, #T2D at 15 years
         c1 = C1_2, #1st genomic principal component     
         c2 = C2_2, #2nd genomic principal component      
         c3 = C3_2, #3rd genomic principal component      
         c4 = C4_2, #4th genomic principal component   
         Val = Val,
         Leu = Leu,
         Ileu = Ileu,
         Ala = Ala,
         GlycA = GlycA,
         Ctr = Ctr,
         KetBod = KetBod,
         B_HB = B_HB,
         AcAc = AcAc,
         Acetone = Acetone,
         Glycine = Glycine,
         Val1 = Val_1,
         Leu1 = Leu_1,
         Ileu1 = Ileu_1,
         Ala1 = Ala_1,
         GlycA1 = GlycA_1,
         Ctr1 = Ctr_1,
         KetBod1 = KetBod_1,
         B_HB1 = B_HB_1,
         AcAc1 = AcAc_1,
         Acetone1 = Acetone_1,
         Glycine1 = Glycine_1,
         IFI = IFI,
         timeshort = XXXX, #time to event for T2D 3.2 yrs
         timelong = XXXX #time to event for T2D 15 yrs
         
  )

###SAVE DATASET
saveRDS(df_renamed, file = "P:/Staff/Guannan/LTF225/DPP_for_analysis_GC.rds")